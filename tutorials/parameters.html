<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WrapperTask and ConcatenationTask &mdash; luisy  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Multi File Management / Directory Output" href="multi_file.html" />
    <link rel="prev" title="Getting started" href="getting_started.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            luisy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about/about.html">Why?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributions.html">Contributions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">WrapperTasks and ConcatenationTasks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#triggering-multiple-task-instances">Triggering multiple Task instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="#concatenation-task">Concatenation Task</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wrappertask">WrapperTask</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dynamic-dependencies">Dynamic Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#triggering-different-executions">Triggering different executions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="multi_file.html">Directory Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud.html">Up- and Downloading Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="reruns.html">Trigger reruns by changing code</a></li>
<li class="toctree-l1"><a class="reference internal" href="spark.html">Interaction with PySpark</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../task.html">Task structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../decorators.html">Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reruns.html">Reruns</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualize.html">Visualize</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cloud.html">Cloud sync</a></li>
<li class="toctree-l1"><a class="reference internal" href="../helpers.html">Helper funcs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hash_update_mode.html">Hash Update Mode</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">Full reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Legal</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../legal/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../legal/corporate_information.html">Corporate information</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">luisy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">WrapperTask and ConcatenationTask</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/parameters.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="wrappertask-and-concatenationtask">
<h1>WrapperTask and ConcatenationTask<a class="headerlink" href="#wrappertask-and-concatenationtask" title="Permalink to this heading"></a></h1>
<section id="triggering-multiple-task-instances">
<h2>Triggering multiple Task instances<a class="headerlink" href="#triggering-multiple-task-instances" title="Permalink to this heading"></a></h2>
<p>Luigi and luisy are using specific parameters to build unique pipelines. The same pipeline can be
executed multiple times with different parameters, having different output. Different than
usual, parameters of tasks are declared in the class scope.</p>
<p>This upcoming pipeline demonstrates the usage of parameters in luisy. Other than luigi, luisy
only uses the decorators <code class="xref py py-class docutils literal notranslate"><span class="pre">inherits</span></code> and
<a class="reference internal" href="../api/luisy.html#luisy.decorators.requires" title="luisy.decorators.requires"><code class="xref py py-func docutils literal notranslate"><span class="pre">requires()</span></code></a> to pass parameters between tasks. This keeps the code
clean and prevents a lot of <em>boilerplate-code</em>.</p>
<p>As always we start with an <a class="reference internal" href="../api/luisy.tasks.html#luisy.tasks.base.ExternalTask" title="luisy.tasks.base.ExternalTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">luisy.tasks.base.ExternalTask</span></code></a> to begin with. This time we
assume we’ve exported some <cite>.parquet</cite> files to our system in our <cite>&lt;working_dir&gt;/raw</cite> directory. The
files are stored in separate folders, where each folder contains data of one month of data in
parquet format.</p>
<pre style="border:1px solid #ccc; background-color: #fcfdff">
<working_dir>/<project_name>
└──
   └── raw
      ├── Partition=2021-01
          ├── part-0001.parquet
          ├── part-0002.parquet
          └── part-0003.parquet
      ├── Partition=2021-02
          └── ...
      ├── ...
      ├── Partition=2021-09
          └── ...
      └── Partition=2021-10
          └── ...
</pre><p>This directory structure can be solved with the following <a class="reference internal" href="../api/luisy.tasks.html#luisy.tasks.base.ExternalTask" title="luisy.tasks.base.ExternalTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExternalTask</span></code></a>.
Note that we use the <a class="reference internal" href="../api/luisy.html#luisy.decorators.parquetdir_output" title="luisy.decorators.parquetdir_output"><code class="xref py py-func docutils literal notranslate"><span class="pre">parquetdir_output()</span></code></a> decorator to tell luisy we want
to parse multiple <cite>.parquet</cite> files. The only code we need to write is the dynamic folder names
<cite>Partition=&lt;month&gt;</cite> which are taking the <cite>month</cite> Parameter that is passed to the task. luisy will
then check on execution, whether the directory of the executed month exists:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">luisy</span>

<span class="nd">@luisy</span><span class="o">.</span><span class="n">raw</span>
<span class="nd">@luisy</span><span class="o">.</span><span class="n">parquetdir_output</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ExportDirectory</span><span class="p">(</span><span class="n">luisy</span><span class="o">.</span><span class="n">ExternalTask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Input directory with (multiple) parquet files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">luisy</span><span class="o">.</span><span class="n">MonthParameter</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_folder_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Partition=</span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">get_month_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>With the ExternalTask setup, we can now use a <a class="reference internal" href="../api/luisy.tasks.html#luisy.tasks.base.Task" title="luisy.tasks.base.Task"><code class="xref py py-class docutils literal notranslate"><span class="pre">Task</span></code></a> to read these
parquet files and store them as a DataFrame into a pickle for further processing. We will still
be working on monthly basis that we can make use of the parallelization of <code class="xref py py-mod docutils literal notranslate"><span class="pre">luigi</span></code>. This
can be useful when you are going to do some computations on the data like throwing out NaN values
for example. The parameter <cite>month</cite> does not need to be defined again in this task, because it’s
derived from <cite>ExportDirectory</cite> by using the decorator <a class="reference internal" href="../api/luisy.html#luisy.decorators.requires" title="luisy.decorators.requires"><code class="xref py py-func docutils literal notranslate"><span class="pre">requires()</span></code></a>.</p>
<p>The data we’ve read is now saved in <cite>‘&lt;working_dir&gt;/&lt;project_name&gt;/interim’</cite> directory,
because this is basically no raw data anymore. The filename of our Task is automatically
generated by <a class="reference internal" href="../api/luisy.html#luisy.decorators.auto_filename" title="luisy.decorators.auto_filename"><code class="xref py py-func docutils literal notranslate"><span class="pre">auto_filename()</span></code></a>. This decorator is used by default for every
<a class="reference internal" href="../api/luisy.tasks.html#luisy.tasks.base.Task" title="luisy.tasks.base.Task"><code class="xref py py-class docutils literal notranslate"><span class="pre">luisy.tasks.base.Task</span></code></a>, resulting in the filename <cite>‘MergeExport_month=&lt;month&gt;
.&lt;output_type&gt;’</cite>. So if this task is called multiple times with different values for the
parameter <cite>month</cite>, we are getting dynamic filenames. The <cite>output_type</cite> is defined by an output
decorators. In our case the file will be saved as a pickle file (<cite>‘.pkl’</cite>). See more about output
decorators at <a class="reference internal" href="../decorators.html"><span class="doc">Decorators</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@luisy</span><span class="o">.</span><span class="n">interim</span>
<span class="nd">@luisy</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="n">ExportDirectory</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MergeExport</span><span class="p">(</span><span class="n">luisy</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Merges all input parquet files from same month into one pickle File</span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Start merge of month </span><span class="se">\&quot;</span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">get_month_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">))</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Export to </span><span class="se">\&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">()</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
<p>With the implementation of this task, we can now do any stuff we want on the data by just
requiring the task above. The upcoming task for example removes NaN values and selects some
columns in the dataframe. The columns are defined as a ListParameter and can therefore as a luisy
Parameter.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@luisy</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="n">MergeExport</span><span class="p">)</span>
<span class="nd">@luisy</span><span class="o">.</span><span class="n">interim</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SomeDataSelection</span><span class="p">(</span><span class="n">luisy</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
    <span class="n">column_names</span> <span class="o">=</span> <span class="n">luisy</span><span class="o">.</span><span class="n">ListParameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column_names</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="concatenation-task">
<h2>Concatenation Task<a class="headerlink" href="#concatenation-task" title="Permalink to this heading"></a></h2>
<p>To finish up the pipeline above we finally want to merge all data into one file. We do this by
applying a <a class="reference internal" href="../api/luisy.tasks.html#luisy.tasks.base.ConcatenationTask" title="luisy.tasks.base.ConcatenationTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConcatenationTask</span></code></a>, which requires <cite>SomeDataSelection</cite> tasks
for multiple months. A <a class="reference internal" href="../api/luisy.tasks.html#luisy.tasks.base.ConcatenationTask" title="luisy.tasks.base.ConcatenationTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConcatenationTask</span></code></a> needs its required tasks to
have a dataframe saved in their output, because the data is merged with <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.concat.html#pandas.concat" title="(in pandas v2.2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">concat()</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dateutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">rrule</span>

<span class="nd">@luisy</span><span class="o">.</span><span class="n">inherits</span><span class="p">(</span><span class="n">SomeDataSelection</span><span class="p">)</span>
<span class="nd">@luisy</span><span class="o">.</span><span class="n">final</span>
<span class="nd">@luisy</span><span class="o">.</span><span class="n">auto_filename</span><span class="p">(</span><span class="n">excl_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MonthConcatenator</span><span class="p">(</span><span class="n">luisy</span><span class="o">.</span><span class="n">ConcatenationTask</span><span class="p">):</span>
    <span class="n">month_start</span> <span class="o">=</span> <span class="n">luigi</span><span class="o">.</span><span class="n">MonthParameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">luigi</span><span class="o">.</span><span class="n">date_interval</span><span class="o">.</span><span class="n">Month</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">month_stop</span> <span class="o">=</span> <span class="n">luigi</span><span class="o">.</span><span class="n">MonthParameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">luigi</span><span class="o">.</span><span class="n">date_interval</span><span class="o">.</span><span class="n">Month</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">month_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date_start</span><span class="p">,</span> <span class="n">date_stop</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates through given months</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">MONTHLY</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">date_start</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_stop</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">datetime</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">requires</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span>
                <span class="n">header</span><span class="o">.</span><span class="n">SomeDataSelection</span><span class="p">,</span>
                <span class="n">month</span><span class="o">=</span><span class="n">month</span>
            <span class="p">)</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">month_iterator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">month_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">month_stop</span><span class="p">)</span>
        <span class="p">]</span>
</pre></div>
</div>
</section>
<section id="wrappertask">
<h2>WrapperTask<a class="headerlink" href="#wrappertask" title="Permalink to this heading"></a></h2>
<p>As an alternative to the ConcatenationTask we have a possibility to keep the data separately
without concatenating it. This often makes sense when you are working with a huge amount of data,
which does not fit in your local memory. In this case we dont want to use some ConcatenationTask
or anything else that merges our data into one huge file.</p>
<p>In this usecase we can use a WrapperTask instead to have a trigger for our pipeline. WrapperTasks
don’t have a <code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code> method implemented and only use
<code class="xref py py-meth docutils literal notranslate"><span class="pre">requires()</span></code> and therefore have no output as well.
The advantage of using WrapperTasks is to have a trigger for your dynamic dependencies like the
month parameter above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@luisy</span><span class="o">.</span><span class="n">inherits</span><span class="p">(</span><span class="n">SomeDataSelection</span><span class="p">)</span>
<span class="nd">@luisy</span><span class="o">.</span><span class="n">final</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MonthWrapper</span><span class="p">(</span><span class="n">luisy</span><span class="o">.</span><span class="n">WrapperTask</span><span class="p">):</span>
<span class="n">month_start</span> <span class="o">=</span> <span class="n">luigi</span><span class="o">.</span><span class="n">MonthParameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">luigi</span><span class="o">.</span><span class="n">date_interval</span><span class="o">.</span><span class="n">Month</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">month_stop</span> <span class="o">=</span> <span class="n">luigi</span><span class="o">.</span><span class="n">MonthParameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">luigi</span><span class="o">.</span><span class="n">date_interval</span><span class="o">.</span><span class="n">Month</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">month_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date_start</span><span class="p">,</span> <span class="n">date_stop</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates through given months</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">MONTHLY</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">date_start</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_stop</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">datetime</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">requires</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span>
            <span class="n">header</span><span class="o">.</span><span class="n">SomeDataSelection</span><span class="p">,</span>
            <span class="n">month</span><span class="o">=</span><span class="n">month</span>
        <span class="p">)</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">month_iterator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">month_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">month_stop</span><span class="p">)</span>
    <span class="p">]</span>
</pre></div>
</div>
</section>
<section id="dynamic-dependencies">
<h2>Dynamic Dependencies<a class="headerlink" href="#dynamic-dependencies" title="Permalink to this heading"></a></h2>
<p>Due to these dynamic dependencies in the tasks above we need to write the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">luisy.Task.requires()</span></code> function by ourselves. To achieve this, we define two new
arguments in our final task <code class="xref py py-attr docutils literal notranslate"><span class="pre">month_start</span></code> and <code class="xref py py-attr docutils literal notranslate"><span class="pre">month_stop</span></code>. Using these
arguments we can now start executing our pipeline for different timespans.</p>
<p>Using the <code class="xref py py-class docutils literal notranslate"><span class="pre">inherits</span></code> decorator we clone all params
(<code class="xref py py-attr docutils literal notranslate"><span class="pre">column_names</span></code> and <code class="xref py py-attr docutils literal notranslate"><span class="pre">month</span></code>) from their parent task
<code class="xref py py-class docutils literal notranslate"><span class="pre">SomeDataSelection</span></code>. Usually we dont want the
<a class="reference internal" href="../api/luisy.tasks.html#luisy.tasks.base.WrapperTask" title="luisy.tasks.base.WrapperTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">WrapperTask</span></code></a> and <a class="reference internal" href="../api/luisy.tasks.html#luisy.tasks.base.ConcatenationTask" title="luisy.tasks.base.ConcatenationTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConcatenationTask</span></code></a> to
have dynamic parameters (like <code class="xref py py-attr docutils literal notranslate"><span class="pre">month</span></code>) inherited because they are irrelevant in
upstream tasks (Information is contained in <code class="xref py py-attr docutils literal notranslate"><span class="pre">month_start</span></code> and <code class="xref py py-attr docutils literal notranslate"><span class="pre">month_stop</span></code>).
This can be done, by not using the <code class="xref py py-meth docutils literal notranslate"><span class="pre">clone()</span></code> function and calling
the Tasks constructor by itself. But this would require us to pass all other params manually into
the
constructor. In the following case we want to use <code class="xref py py-meth docutils literal notranslate"><span class="pre">clone()</span></code> to inherit
the parameter <code class="xref py py-attr docutils literal notranslate"><span class="pre">column_names</span></code>. Hence in the case of a <code class="xref py py-class docutils literal notranslate"><span class="pre">ConcatenationTask</span></code> we tell our
<a class="reference internal" href="../api/luisy.html#luisy.decorators.auto_filename" title="luisy.decorators.auto_filename"><code class="xref py py-func docutils literal notranslate"><span class="pre">auto_filename()</span></code></a> function to exclude parameters with the value <cite>None</cite>
from the filename, which then creates the filename
<cite>‘MonthConcatenator_month-start=2021-01_month_stop=2021-10_column_names=A-B-C’</cite>.</p>
</section>
<section id="triggering-different-executions">
<h2>Triggering different executions<a class="headerlink" href="#triggering-different-executions" title="Permalink to this heading"></a></h2>
<p>Taking the code above, we are now able to run the pipeline with different parameters for different
results. Having all observations from 2021-01 to 2021-10 of the columns ‘ProcessingDate’ and ‘ID’
in one file would be triggered by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>luisy<span class="w"> </span><span class="o">[</span>project_name<span class="o">]</span>.<span class="o">[</span>module<span class="o">]</span><span class="w"> </span>MonthConcatenator<span class="w"> </span>--month-start<span class="o">=</span><span class="s1">&#39;2021-01&#39;</span><span class="w"> </span>--month-stop<span class="o">=</span><span class="s1">&#39;2021-10&#39;</span>
--column-names<span class="o">=</span><span class="s1">&#39;[&quot;ProcessingDate&quot;, &quot;ID&quot;]&#39;</span>
</pre></div>
</div>
<p>By changing the parameters after your first execution we can adjust our output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>luisy<span class="w"> </span><span class="o">[</span>project_name<span class="o">]</span>.<span class="o">[</span>module<span class="o">]</span><span class="w"> </span>MonthConcatenator<span class="w"> </span>--month-start<span class="o">=</span><span class="s1">&#39;2021-01&#39;</span><span class="w"> </span>--month-stop<span class="o">=</span><span class="s1">&#39;2021-05&#39;</span>
--column-names<span class="o">=</span><span class="s1">&#39;[&quot;ProcessingDate&quot;, &quot;ID&quot;, &quot;ProcessResult&quot;]&#39;</span>
</pre></div>
</div>
<p>This will also contain the ProcessResult in our final Dataframe and only consider data between
january and may.</p>
<p>If we don’t want the result to be merged into one file we would use the WrapperTask we defined
above:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>luisy<span class="w"> </span><span class="o">[</span>project_name<span class="o">]</span>.<span class="o">[</span>module<span class="o">]</span><span class="w"> </span>MonthWrapper<span class="w"> </span>--month-start<span class="o">=</span><span class="s1">&#39;2021-01&#39;</span><span class="w"> </span>--month-stop<span class="o">=</span><span class="s1">&#39;2021-10&#39;</span>
--column-names<span class="o">=</span><span class="s1">&#39;[&quot;ProcessingDate&quot;, &quot;ID&quot;]&#39;</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="getting_started.html" class="btn btn-neutral float-left" title="Getting started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="multi_file.html" class="btn btn-neutral float-right" title="Multi File Management / Directory Output" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2022, Robert Bosch GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>